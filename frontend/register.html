<!DOCTYPE html>
<html>

<head>
    <title>Register</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>
    <h2>Registration Form</h2>
    <form id="registerForm" action="/register" method="POST">
        <input type="text" name="name" id="name" placeholder="Name" required><br>

        
        <!-- Email + Send OTP -->
<div class="email-otp-container">
    <input type="email" name="email" id="email" placeholder="Email" required>
    <button type="button" id="sendOtpBtn">Send OTP</button>
</div>

        <br>

        <!-- OTP field (hidden initially) -->
        <div id="otpSection" style="display: none;">
            <input type="text" id="otp" placeholder="Enter OTP" style="width: 100%; margin-bottom: 10px;">
            <button type="button" id="verifyOtpBtn">Verify OTP</button>
        </div>

        <input type="text" name="mobile" id="mobile" placeholder="Mobile Number" required><br>

        <div class="password-container">
            <input type="password" name="password" id="password" placeholder="Password" required>
            <i class="fa-solid fa-eye toggle-password" onclick="togglePassword('password', this)"></i>
        </div><br>

        <div class="password-container">
            <input type="password" name="confirmPassword" id="confirmPassword" placeholder="Confirm Password" required>
            <i class="fa-solid fa-eye toggle-password" onclick="togglePassword('confirmPassword', this)"></i>
        </div><br>

        <select name="group_name" id="group_name" required>
  <option value="">Select Group</option>
  <option value="Admin">Admin</option>
  <option value="HR">HR</option>
  <option value="Finance">Finance</option>
  <option value="SWT">SWT</option>
  <option value="HWT">HWT</option>
  <option value="ISS">ISS</option>
  <option value="CH Office">CH Office</option>
  <option value="MIS">MIS</option>
  <option value="PMU">PMU</option>
  <option value="E&T">E&T</option>
  <option value="NetOps">NetOps</option>
  <option value="MMG">MMG</option>
</select><br>


        <button type="submit" id="registerBtn" disabled>Register</button>
    </form>

    <p>Already have an account? <a href="/">Login</a></p>

    <script>
        // Show/hide password
        function togglePassword(id, icon) {
            const input = document.getElementById(id);
            if (input.type === "password") {
                input.type = "text";
                icon.classList.remove("fa-eye");
                icon.classList.add("fa-eye-slash");
            } else {
                input.type = "password";
                icon.classList.remove("fa-eye-slash");
                icon.classList.add("fa-eye");
            }
        }

        // Send OTP
        document.getElementById("sendOtpBtn").addEventListener("click", async () => {
            const email = document.getElementById("email").value.trim();
            if (!email) return alert("Please enter your email.");

            
const res = await fetch("/send-otp", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email })
});

            const data = await res.json();
            if (data.success) {
                alert("OTP sent to your email!");
                document.getElementById("otpSection").style.display = "block";
            } else {
                alert("Error sending OTP. Please try again.");
            }
        });

        // Verify OTP
        document.getElementById("verifyOtpBtn").addEventListener("click", async () => {
            const email = document.getElementById("email").value.trim();
            const otp = document.getElementById("otp").value.trim();
            if (!otp) return alert("Please enter OTP.");


const res = await fetch("/verify-otp", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ email, otp })
});


            const data = await res.json();
            if (data.verified) {
                alert("OTP verified successfully! You can register now.");
                document.getElementById("registerBtn").disabled = false;
                document.getElementById("verifyOtpBtn").disabled = true;
            } else {
                alert("Invalid OTP. Please try again.");
            }
        });

        // Validation and password confirmation
        document.getElementById("registerForm").addEventListener("submit", function (e) {
            const name = document.getElementById("name").value.trim();
            const email = document.getElementById("email").value.trim();
            const mobile = document.getElementById("mobile").value.trim();
            const pass = document.getElementById("password").value;
            const confirm = document.getElementById("confirmPassword").value;

            const namePattern = /^[A-Za-z\s]+$/;
            if (!namePattern.test(name)) {
                e.preventDefault();
                alert("Name must contain letters only.");
                return;
            }

            const mobilePattern = /^[0-9]{10}$/;
            if (!mobilePattern.test(mobile)) {
                e.preventDefault();
                alert("Mobile number must be exactly 10 digits.");
                return;
            }

            const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailPattern.test(email)) {
                e.preventDefault();
                alert("Please enter a valid email address.");
                return;
            }

            if (pass !== confirm) {
                e.preventDefault();
                alert("Passwords do not match!");
                return;
            }
        });
    </script>
</body>

</html>
