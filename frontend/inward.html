<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>New Inward Correspondence Entry</title>
    <link rel="stylesheet" href="inward-style.css" />

  </head>

  <body>
    <div class="inward-container">
      <h2>New Inward Correspondence Entry</h2>

      <form id="inwardForm" action="/inward/add" method="POST">
        <!-- LEFT COLUMN -->
        <div class="left-column">
          <label>* Inward Date:</label>
          <input type="date" name="date_of_receipt" id="inwardDate" required />
          <span id="err_date" class="error"></span>

          <label>Month :</label>
          <input type="text" name="month" id="month" readonly />

          <label>Year :</label>
          <input type="text" name="year" id="year" readonly />

          <label>* Office (Received In):</label>
          <select name="received_in" id="received_in" required>
            <option value="">Select Office</option>
            <option value="Silchar">Silchar</option>
            <option value="Guwahati">Guwahati</option>
          </select>
          <span id="err_office" class="error"></span>

          <label>* Name of Sender:</label>
          <input
            type="text"
            name="name_of_sender"
            id="name_of_sender"
            placeholder="Enter Sender Name"
            maxlength="100"
            required
            pattern="[A-Za-z ]+"
          />
          <span id="err_name_of_sender" class="error"></span>

          <label>Address of Sender:</label>
          <input
            type="text"
            name="address_of_sender"
            maxlength="255"
            placeholder="Enter Address"
          />

          <label>City:</label>
          <input
            type="text"
            name="sender_city"
            maxlength="100"
            placeholder="Enter City"
          />
          <span id="err_sender_city" class="error"></span>

          <label>State:</label>
          <select name="sender_state" id="senderState">
            <option value="">Select State</option>

            <!-- Region A -->
            <option>Bihar</option>
            <option>Haryana</option>
            <option>Himachal Pradesh</option>
            <option>Madhya Pradesh</option>
            <option>Rajasthan</option>
            <option>Uttar Pradesh</option>
            <option>Jharkhand</option>
            <option>Chhattisgarh</option>
            <option>Uttarakhand</option>
            <option>Delhi</option>
            <option>Andaman & Nicobar Islands</option>

            <!-- Region B -->
            <option>Gujarat</option>
            <option>Maharashtra</option>
            <option>Punjab</option>
            <option>Chandigarh</option>
            <option>Daman & Diu</option>
            <option>Dadra & Nagar Haveli</option>

            <!-- Region C -->
            <option>Andhra Pradesh</option>
            <option>Arunachal Pradesh</option>
            <option>Assam</option>
            <option>Goa</option>
            <option>Kerala</option>
            <option>Tamil Nadu</option>
            <option>West Bengal</option>
            <option>Karnataka</option>
            <option>Odisha</option>
            <option>Telangana</option>
            <option>Sikkim</option>
            <option>Tripura</option>
            <option>Meghalaya</option>
            <option>Mizoram</option>
            <option>Nagaland</option>
            <option>Manipur</option>
            <option>Puducherry</option>
            <option>Lakshadweep</option>
            <option>Ladakh</option>
            <option>Jammu & Kashmir</option>
          </select>

          <label>Pin Code:</label>
          <input
            type="text"
            name="sender_pin"
            id="sender_pin"
            maxlength="6"
            placeholder="Enter 6-digit Pin"
            pattern="[0-9]{6}"
            required
          />
          <span id="err_pin" class="error"></span>

          <label>Region :</label>
          <input
            type="text"
            name="sender_region"
            id="senderRegion"
            placeholder="(A/B/C)"
            readonly
          />

          <label>Sender Organization Type:</label>
          <select name="sender_org_type">
            <option value="">Select Type</option>
            <option>Central</option>
            <option>State</option>
            <option>Private</option>
            <option>Individual</option>
          </select>
        </div>

        <!-- RIGHT COLUMN -->
        <div class="right-column">
          <label>* Inward No. :</label>
          <input
            type="text"
            id="inwardNo"
            readonly
            placeholder="Auto Generated by System"
          />

          <label>* Type of Document:</label>
          <select name="type_of_document" id="type_of_document" required>
            <option value="">Select Document Type</option>
            <option>Letter</option>
            <option>Bill</option>
            <option>Other Document</option>
          </select>
          <span id="err_doc_type" class="error"></span>

          <label>Language of Document:</label>
          <select name="language_of_document">
            <option value="">Select Language</option>
            <option>English</option>
            <option>Hindi</option>
            <option>Bilingual</option>
          </select>

          <label>Count:</label>
          <input
            type="number"
            name="count"
            min="0"
            max="9999"
            placeholder="Number of Copies"
          />
          <span id="err_count" class="error"></span>

          <label>Remarks:</label>
          <select name="remarks">
            <option value="">Select Remark</option>
            <option>Action</option>
            <option>Information</option>
          </select>

          <label>Issued To (Employee Name):</label>
          <input
            type="text"
            name="issued_to"
            maxlength="100"
            placeholder="Enter Employee Name"
          />
          <span id="err_issued_to" class="error"></span>

          <label>Reply Required:</label>
          <select name="reply_required" id="reply_required" required>
            <option value="">Select Option</option>
            <option>Yes</option>
            <option>No</option>
          </select>
          <span id="err_reply_required" class="error"></span>

          <label>Reply Sent Date:</label>
          <input type="date" name="reply_sent_date" />

          <label>Reply Reference No.:</label>
          <input
            type="text"
            name="reply_ref_no"
            maxlength="100"
            placeholder="Reference Number"
          />
          <span id="err_reply_ref_no" class="error"></span>

          <label>Reply Sent By:</label>
          <select name="reply_sent_by">
            <option value="">Select Mode</option>
            <option>Speed Post</option>
            <option>Email</option>
          </select>

          <label>Reply Sent In:</label>
          <select name="reply_sent_in">
            <option value="">Select Language</option>
            <option>English</option>
            <option>Hindi</option>
            <option>Bilingual</option>
          </select>

          <label>Reply Count:</label>
          <input
            type="number"
            name="reply_count"
            min="0"
            max="9999"
            placeholder="Number of Replies"
          />
          <span id="err_reply_count" class="error"></span>
        </div>

        <div class="button-container">
          <button type="submit">Save Inward Entry</button>
        </div>
      </form>
    </div>

    <script>
      /* ----- REGION MAP ----- */
      const stateToRegion = {
        Bihar: "A",
        Haryana: "A",
        "Himachal Pradesh": "A",
        "Madhya Pradesh": "A",
        Rajasthan: "A",
        "Uttar Pradesh": "A",
        Jharkhand: "A",
        Chhattisgarh: "A",
        Uttarakhand: "A",
        Delhi: "A",
        "Andaman & Nicobar Islands": "A",
        Gujarat: "B",
        Maharashtra: "B",
        Punjab: "B",
        Chandigarh: "B",
        "Daman & Diu": "B",
        "Dadra & Nagar Haveli": "B",
        "Andhra Pradesh": "C",
        "Arunachal Pradesh": "C",
        Assam: "C",
        Goa: "C",
        Kerala: "C",
        "Tamil Nadu": "C",
        "West Bengal": "C",
        Karnataka: "C",
        Odisha: "C",
        Telangana: "C",
        Sikkim: "C",
        Tripura: "C",
        Meghalaya: "C",
        Mizoram: "C",
        Nagaland: "C",
        Manipur: "C",
        Puducherry: "C",
        Lakshadweep: "C",
        Ladakh: "C",
        "Jammu & Kashmir": "C",
      };

      /* ----- AUTO REGION ----- */
      document
        .getElementById("senderState")
        .addEventListener("change", function () {
          document.getElementById("senderRegion").value =
            stateToRegion[this.value] || "";
        });

      /* ----- AUTO MONTH & YEAR ----- */
      document
        .getElementById("inwardDate")
        .addEventListener("change", function () {
          const d = new Date(this.value);
          if (!isNaN(d)) {
            document.getElementById("month").value = [
              "January",
              "February",
              "March",
              "April",
              "May",
              "June",
              "July",
              "August",
              "September",
              "October",
              "November",
              "December",
            ][d.getMonth()];
            document.getElementById("year").value = d.getFullYear();
          }
        });

      /* ----- PIN CLEAN ----- */
      document
        .getElementById("sender_pin")
        .addEventListener("input", function () {
          this.value = this.value.replace(/\D/g, "").slice(0, 6);
        });

      /* ----- COUNT PROTECTION ----- */
      document
        .querySelector("[name='count']")
        .addEventListener("input", function () {
          if (this.value < 0) this.value = 0;
        });
      document
        .querySelector("[name='reply_count']")
        .addEventListener("input", function () {
          if (this.value < 0) this.value = 0;
        });

      /* ----- ERROR DISPLAY HELPERS ----- */
      function showError(id, msg) {
        const el = document.getElementById(id);
        el.style.display = "block";
        el.textContent = msg;
      }
      function clearError(id) {
        document.getElementById(id).style.display = "none";
      }

      /* ----- LIVE FIELD VALIDATION ----- */
      document
        .getElementById("name_of_sender")
        .addEventListener("input", function () {
          /^[A-Za-z ]+$/.test(this.value)
            ? clearError("err_name_of_sender")
            : showError("err_name_of_sender", "Only alphabets allowed");
        });

      document
        .querySelector("[name='sender_city']")
        .addEventListener("input", function () {
          /^[A-Za-z ]*$/.test(this.value)
            ? clearError("err_sender_city")
            : showError("err_sender_city", "City must contain only letters");
        });

      document
        .getElementById("sender_pin")
        .addEventListener("input", function () {
          /^\d{6}$/.test(this.value)
            ? clearError("err_pin")
            : showError("err_pin", "PIN must be exactly 6 digits");
        });

      /* ----- FORM SUBMIT VALIDATION ----- */
      document
        .getElementById("inwardForm")
        .addEventListener("submit", function (e) {
          let valid = true,
            firstError = null;

          function fail(fieldName, errorField, msg) {
            valid = false;
            showError(errorField, msg);
            const field =
              document.getElementById(fieldName) ||
              document.querySelector("[name='" + fieldName + "']");
            if (!firstError) firstError = field;
          }

          // Clear old errors
          document
            .querySelectorAll(".error")
            .forEach((el) => (el.style.display = "none"));

          // Date
          if (inwardDate.value === "")
            fail("inwardDate", "err_date", "Please select a date");

          // Office
          if (received_in.value === "")
            fail("received_in", "err_office", "Select an office");

          // Sender name
          if (!/^[A-Za-z ]+$/.test(name_of_sender.value.trim()))
            fail(
              "name_of_sender",
              "err_name_of_sender",
              "Only alphabets allowed"
            );

          // Sender city
          const city = document
            .querySelector("[name='sender_city']")
            .value.trim();
          if (city && !/^[A-Za-z ]+$/.test(city))
            fail(
              "sender_city",
              "err_sender_city",
              "City must contain only letters"
            );

          // PIN
          if (!/^\d{6}$/.test(sender_pin.value))
            fail("sender_pin", "err_pin", "PIN must be exactly 6 digits");

          // Doc type
          if (type_of_document.value === "")
            fail("type_of_document", "err_doc_type", "Select a document type");

          // Reply required
          if (reply_required.value === "")
            fail("reply_required", "err_reply_required", "Choose yes or no");

          // Count
          const ct = document.querySelector("[name='count']").value;
          if (ct && (ct < 0 || ct > 9999))
            fail("count", "err_count", "Count must be between 0 and 9999");

          // Reply Count
          const rct = document.querySelector("[name='reply_count']").value;
          if (rct && (rct < 0 || rct > 9999))
            fail(
              "reply_count",
              "err_reply_count",
              "Reply count must be 0â€“9999"
            );

          // Reference No
          const ref = document.querySelector("[name='reply_ref_no']").value;
          if (ref.length > 100)
            fail(
              "reply_ref_no",
              "err_reply_ref_no",
              "Max 100 characters allowed"
            );

          if (!valid) {
            e.preventDefault();
            if (firstError)
              firstError.scrollIntoView({
                behavior: "smooth",
                block: "center",
              });
          }
        });
    </script>
  </body>
</html>
